var e=Object.defineProperty,t=(t,s,i)=>((t,s,i)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[s]=i)(t,"symbol"!=typeof s?s+"":s,i);import{r as s,g as i}from"./phaser-CLYd3JIB.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const a=i(s());class r extends a.Scene{constructor(){super({key:"GameOverScene"}),t(this,"background")}init(e){}preload(){this.load.image("gameover-background","assets/images/backgrounds/gameover-background.png"),this.load.audio("game_over","assets/sound/game_over.ogg")}create(){this.sound.play("game_over"),this.background=this.add.image(228,0,"gameover-background").setOrigin(.5,0),this.cameras.main.setScroll(0,-720),this.cameras.main.pan(228,360,2e3,"Linear",!1),this.time.delayedCall(3e3,(()=>{this.scene.start("WelcomeScene")}))}update(e){}}class n extends a.Scene{constructor(){super({key:"ScoresScene"}),t(this,"background"),t(this,"textStageNumber"),t(this,"textPlayerOnePoints"),t(this,"textPlayerOneRegulars"),t(this,"textPlayerOneSpeedies"),t(this,"textPlayerOneShooters"),t(this,"textPlayerOneHeavies"),t(this,"textPlayerOneTotal"),t(this,"gameProgress")}init(e){this.gameProgress=e,this.gameProgress.calculateStageStats()}preload(){this.load.image("scores-background","assets/images/backgrounds/scores-background.png")}create(){const e="     PTS   ";this.background=this.add.image(0,0,"scores-background").setOrigin(0,0),this.textStageNumber=this.add.bitmapText(292,119,"console-font","STAGE  "+this.gameProgress.stageNumber,24),this.textStageNumber.setTint(15658734);const t=this.buildPlayerPoints(this.gameProgress.playerOneTotalPoints);this.textPlayerOnePoints=this.add.bitmapText(124,215,"console-font",t,24),this.textPlayerOnePoints.setTint(16758272),this.textPlayerOneRegulars=this.add.bitmapText(76,287,"console-font",e,24),this.textPlayerOneRegulars.setTint(15658734),this.time.delayedCall(500,(()=>{const e=this.buildTanksMessage(this.gameProgress.playerOneRegularsCount,this.gameProgress.playerOneRegularsPoints);this.textPlayerOneRegulars.setText(e)})),this.textPlayerOneSpeedies=this.add.bitmapText(76,359,"console-font",e,24),this.textPlayerOneSpeedies.setTint(15658734),this.time.delayedCall(1e3,(()=>{const e=this.buildTanksMessage(this.gameProgress.playerOneSpeediesCount,this.gameProgress.playerOneSpeediesPoints);this.textPlayerOneSpeedies.setText(e)})),this.textPlayerOneShooters=this.add.bitmapText(76,431,"console-font",e,24),this.textPlayerOneShooters.setTint(15658734),this.time.delayedCall(1500,(()=>{const e=this.buildTanksMessage(this.gameProgress.playerOneShootersCount,this.gameProgress.playerOneShootersPoints);this.textPlayerOneShooters.setText(e)})),this.textPlayerOneHeavies=this.add.bitmapText(76,503,"console-font",e,24),this.textPlayerOneHeavies.setTint(15658734),this.time.delayedCall(2e3,(()=>{const e=this.buildTanksMessage(this.gameProgress.playerOneHeaviesCount,this.gameProgress.playerOneHeaviesPoints);this.textPlayerOneHeavies.setText(e)})),this.textPlayerOneTotal=this.add.bitmapText(76,576,"console-font","   TOTAL   ",24),this.textPlayerOneTotal.setTint(15658734),this.time.delayedCall(2500,(()=>{const e=this.buildTotalMessage(this.gameProgress.playerOneStageCount);this.textPlayerOneTotal.setText(e)})),this.time.delayedCall(5e3,(()=>{this.gameProgress.nextStage(),this.scene.start("StageNumberScene",this.gameProgress)}))}update(e){}buildPlayerPoints(e){return this.padRight(e,6," ")}buildTanksMessage(e,t){return this.padRight(t,4," ")+" PTS "+this.padRight(e,2," ")}buildTotalMessage(e){return"   TOTAL "+this.padRight(e,2," ")}padRight(e,t,s=" "){let i=e.toString();for(;i.length<t;)i=s+i;return i}}class o{static create(e){const t="game-anim-bullet-up",s="game-anim-bullet-right",i="game-anim-bullet-down",a="game-anim-bullet-left",r="game-anim-bullet-explosion",n="game-bullet";void 0===e.anims.get(t)&&e.anims.create({frameRate:10,frames:e.anims.generateFrameNumbers(n,{start:0,end:0}),key:t,repeat:0}),void 0===e.anims.get(s)&&e.anims.create({frameRate:10,frames:e.anims.generateFrameNumbers(n,{start:1,end:1}),key:s,repeat:0}),void 0===e.anims.get(i)&&e.anims.create({frameRate:10,frames:e.anims.generateFrameNumbers(n,{start:2,end:2}),key:i,repeat:0}),void 0===e.anims.get(a)&&e.anims.create({frameRate:10,frames:e.anims.generateFrameNumbers(n,{start:3,end:3}),key:a,repeat:0}),void 0===e.anims.get(r)&&e.anims.create({frameRate:20,frames:e.anims.generateFrameNumbers("game-bullet-explosion",{start:0,end:3}),key:r,repeat:0})}}class h{static create(e){const t="game-anim-heavy-enemy-up",s="game-anim-heavy-enemy-right",i="game-anim-heavy-enemy-down",a="game-anim-heavy-enemy-left",r="game-anim-heavy-explosion",n="game-enemy-heavy";if(void 0===e.anims.get(t)&&e.anims.create({frameRate:10,frames:e.anims.generateFrameNumbers(n,{start:0,end:1}),key:t,repeat:0}),void 0===e.anims.get(s)&&e.anims.create({frameRate:10,frames:e.anims.generateFrameNumbers(n,{start:2,end:3}),key:s,repeat:0}),void 0===e.anims.get(i)&&e.anims.create({frameRate:10,frames:e.anims.generateFrameNumbers(n,{start:4,end:5}),key:i,repeat:0}),void 0===e.anims.get(a)&&e.anims.create({frameRate:10,frames:e.anims.generateFrameNumbers(n,{start:6,end:7}),key:a,repeat:0}),void 0===e.anims.get(r)){const t=e.anims.create({frameRate:9,frames:e.anims.generateFrameNumbers("game-tank-explosion",{start:0,end:5}),key:r,repeat:0});if(t){const s=e.anims.generateFrameNumbers("game-points",{start:3,end:3});t.addFrame(s)}}}}class l{static create(e){const t="game-anim-regular-enemy-up",s="game-anim-regular-enemy-right",i="game-anim-regular-enemy-down",a="game-anim-regular-enemy-left",r="game-anim-regular-explosion",n="game-enemy-regular";if(void 0===e.anims.get(t)&&e.anims.create({frameRate:10,frames:e.anims.generateFrameNumbers(n,{start:0,end:1}),key:t,repeat:0}),void 0===e.anims.get(s)&&e.anims.create({frameRate:10,frames:e.anims.generateFrameNumbers(n,{start:2,end:3}),key:s,repeat:0}),void 0===e.anims.get(i)&&e.anims.create({frameRate:10,frames:e.anims.generateFrameNumbers(n,{start:4,end:5}),key:i,repeat:0}),void 0===e.anims.get(a)&&e.anims.create({frameRate:10,frames:e.anims.generateFrameNumbers(n,{start:6,end:7}),key:a,repeat:0}),void 0===e.anims.get(r)){const t=e.anims.create({frameRate:9,frames:e.anims.generateFrameNumbers("game-tank-explosion",{start:0,end:5}),key:r,repeat:0});if(t){const s=e.anims.generateFrameNumbers("game-points",{start:0,end:0});t.addFrame(s)}}}}class m{static create(e){const t="game-anim-shooter-enemy-up",s="game-anim-shooter-enemy-right",i="game-anim-shooter-enemy-down",a="game-anim-shooter-enemy-left",r="game-anim-shooter-explosion",n="game-enemy-shooter";if(void 0===e.anims.get(t)&&e.anims.create({frameRate:10,frames:e.anims.generateFrameNumbers(n,{start:0,end:1}),key:t,repeat:0}),void 0===e.anims.get(s)&&e.anims.create({frameRate:10,frames:e.anims.generateFrameNumbers(n,{start:2,end:3}),key:s,repeat:0}),void 0===e.anims.get(i)&&e.anims.create({frameRate:10,frames:e.anims.generateFrameNumbers(n,{start:4,end:5}),key:i,repeat:0}),void 0===e.anims.get(a)&&e.anims.create({frameRate:10,frames:e.anims.generateFrameNumbers(n,{start:6,end:7}),key:a,repeat:0}),void 0===e.anims.get(r)){const t=e.anims.create({frameRate:9,frames:e.anims.generateFrameNumbers("game-tank-explosion",{start:0,end:5}),key:r,repeat:0});if(t){const s=e.anims.generateFrameNumbers("game-points",{start:2,end:2});t.addFrame(s)}}}}class g{static create(e){const t="game-anim-speedy-enemy-up",s="game-anim-speedy-enemy-right",i="game-anim-speedy-enemy-down",a="game-anim-speedy-enemy-left",r="game-anim-speedy-explosion",n="game-enemy-speedy";if(void 0===e.anims.get(t)&&e.anims.create({frameRate:10,frames:e.anims.generateFrameNumbers(n,{start:0,end:1}),key:t,repeat:0}),void 0===e.anims.get(s)&&e.anims.create({frameRate:10,frames:e.anims.generateFrameNumbers(n,{start:2,end:3}),key:s,repeat:0}),void 0===e.anims.get(i)&&e.anims.create({frameRate:10,frames:e.anims.generateFrameNumbers(n,{start:4,end:5}),key:i,repeat:0}),void 0===e.anims.get(a)&&e.anims.create({frameRate:10,frames:e.anims.generateFrameNumbers(n,{start:6,end:7}),key:a,repeat:0}),void 0===e.anims.get(r)){const t=e.anims.create({frameRate:9,frames:e.anims.generateFrameNumbers("game-tank-explosion",{start:0,end:5}),key:r,repeat:0});if(t){const s=e.anims.generateFrameNumbers("game-points",{start:1,end:1});t.addFrame(s)}}}}class c{static create(e){const t="game-anim-fortress-destroyed";void 0===e.anims.get(t)&&e.anims.create({frameRate:10,frames:e.anims.generateFrameNumbers("game-fortress",{start:1,end:1}),key:t,repeat:0})}}class d{static create(e){const t="game-anim-player01-up",s="game-anim-player01-right",i="game-anim-player01-down",a="game-anim-player01-left",r="game-anim-player01-explosion",n="game-player-one";void 0===e.anims.get(t)&&e.anims.create({frameRate:10,frames:e.anims.generateFrameNumbers(n,{start:0,end:1}),key:t,repeat:0}),void 0===e.anims.get(s)&&e.anims.create({frameRate:10,frames:e.anims.generateFrameNumbers(n,{start:2,end:3}),key:s,repeat:0}),void 0===e.anims.get(i)&&e.anims.create({frameRate:10,frames:e.anims.generateFrameNumbers(n,{start:4,end:5}),key:i,repeat:0}),void 0===e.anims.get(a)&&e.anims.create({frameRate:10,frames:e.anims.generateFrameNumbers(n,{start:6,end:7}),key:a,repeat:0}),void 0===e.anims.get(r)&&e.anims.create({frameRate:9,frames:e.anims.generateFrameNumbers("game-tank-explosion",{start:0,end:5}),key:r,repeat:0})}}class u{static create(e){const t="game-anim-player02-up",s="game-anim-player02-right",i="game-anim-player02-down",a="game-anim-player02-left",r="game-anim-player02-explosion",n="game-player-two";void 0===e.anims.get(t)&&e.anims.create({frameRate:10,frames:e.anims.generateFrameNumbers(n,{start:0,end:1}),key:t,repeat:0}),void 0===e.anims.get(s)&&e.anims.create({frameRate:10,frames:e.anims.generateFrameNumbers(n,{start:2,end:3}),key:s,repeat:0}),void 0===e.anims.get(i)&&e.anims.create({frameRate:10,frames:e.anims.generateFrameNumbers(n,{start:4,end:5}),key:i,repeat:0}),void 0===e.anims.get(a)&&e.anims.create({frameRate:10,frames:e.anims.generateFrameNumbers(n,{start:6,end:7}),key:a,repeat:0}),void 0===e.anims.get(r)&&e.anims.create({frameRate:9,frames:e.anims.generateFrameNumbers("game-tank-explosion",{start:0,end:5}),key:r,repeat:0})}}class y{static create(e){const t="game-anim-spawn-point-blink";void 0===e.anims.get(t)&&e.anims.create({frameRate:16,frames:e.anims.generateFrameNumbers("game-spawn-blink",{start:0,end:3}),hideOnComplete:!0,key:t,repeat:1,yoyo:!0})}}class p{constructor(e){t(this,"key"),t(this,"currentDirection"),t(this,"previousDirection"),this.key=e}setNewDirection(e){this.previousDirection=this.currentDirection,this.currentDirection=e}}class v{static register(e){void 0===this.stateControlEnemies&&(this.stateControlEnemies=new Array(0));const t=new p(e);this.stateControlEnemies.push(t)}static processMovement(e,t){const s=e.getData("stop"),i=e.getData("type");if(s)return;const r=this.getStateControlEnemy(e);void 0!==r&&(e.setVelocity(0,0),r.setNewDirection(t),t===a.UP?(e.setVelocity(0,-this.ENEMIES_SPEED),e.anims.play("game-anim-"+i+"-enemy-up",!0)):t===a.RIGHT?(e.setVelocity(this.ENEMIES_SPEED,0),e.anims.play("game-anim-"+i+"-enemy-right",!0)):t===a.DOWN?(e.setVelocity(0,this.ENEMIES_SPEED),e.anims.play("game-anim-"+i+"-enemy-down",!0)):t===a.LEFT&&(e.setVelocity(-this.ENEMIES_SPEED,0),e.anims.play("game-anim-"+i+"-enemy-left",!0)))}static getDirection(e){const t=this.getStateControlEnemy(e);return void 0===t?-1:t.currentDirection}static isDirectionDown(e){const t=this.getStateControlEnemy(e);return void 0!==t&&t.currentDirection===a.DOWN}static isDirectionLeft(e){const t=this.getStateControlEnemy(e);return void 0!==t&&t.currentDirection===a.LEFT}static isDirectionRight(e){const t=this.getStateControlEnemy(e);return void 0!==t&&t.currentDirection===a.RIGHT}static isDirectionUp(e){const t=this.getStateControlEnemy(e);return void 0!==t&&t.currentDirection===a.UP}static getStateControlEnemy(e){const t=e.getData("name");return this.stateControlEnemies.filter((e=>e.key===t))[0]}}t(v,"ENEMIES_SPEED",120),t(v,"stateControlEnemies");class b{constructor(e){t(this,"key"),t(this,"movementCounter"),t(this,"movementThreshold"),t(this,"movementValue"),t(this,"shootingCounter"),t(this,"shootingThreshold"),this.key=e}}class f{static register(e){void 0===this.stateMachineEnemies&&(this.stateMachineEnemies=new Array(0));const t=new b(e);t.movementCounter=0,t.movementThreshold=this.nextFpsThreshold(this.MOV_THRESHOLD_MIN,this.MOV_THRESHOLD_MAX),t.movementValue=Phaser.DOWN,t.shootingCounter=0,t.shootingThreshold=this.nextFpsThreshold(this.SHOOT_THRESHOLD_MIN,this.SHOOT_THRESHOLD_MAX),this.stateMachineEnemies.push(t)}static getMovement(e){const t=this.stateMachineEnemies.filter((t=>t.key===e))[0];return void 0===t?-1:(t.movementCounter+=1,t.movementCounter===t.movementThreshold&&(t.movementCounter=0,t.movementThreshold=this.nextFpsThreshold(this.MOV_THRESHOLD_MIN,this.MOV_THRESHOLD_MAX),t.movementValue=this.nextMovementValue()),t.movementValue)}static getShooting(e){const t=this.stateMachineEnemies.filter((t=>t.key===e))[0];return void 0!==t&&(t.shootingCounter+=1,t.shootingCounter===t.shootingThreshold&&(t.shootingCounter=0,t.shootingThreshold=this.nextFpsThreshold(this.SHOOT_THRESHOLD_MIN,this.SHOOT_THRESHOLD_MAX),!0))}static nextMovementValue(){return Phaser.Math.RND.integerInRange(5,8)}static nextFpsThreshold(e,t){return Phaser.Math.RND.integerInRange(e,t)}}t(f,"MOV_THRESHOLD_MAX",240),t(f,"MOV_THRESHOLD_MIN",0),t(f,"SHOOT_THRESHOLD_MAX",240),t(f,"SHOOT_THRESHOLD_MIN",0),t(f,"stateMachineEnemies");class P{static parse(e,t,s,i,a){const r="name",n="type",o="spawn";let h=0,l=0,m="";this.spawnPointLeft=e.add.sprite(this.getPosX("left"),36,"game-spawn-point"),this.spawnPointCenter=e.add.sprite(this.getPosX("center"),36,"game-spawn-point"),this.spawnPointRight=e.add.sprite(this.getPosX("right"),36,"game-spawn-point"),s.enemies.forEach((s=>{e.time.delayedCall(s.delay,(()=>{const g=this.selectSpawnPoint(s[o]);g.setAlpha(.8),g.setVisible(!0),g.setDepth(1),g.anims.play("game-anim-spawn-point-blink",!0),e.time.delayedCall(900,(()=>{h=this.getPosX(s[o]),l=36,m=this.getSpriteKey(s[n]);const g=t.create(h,l,m,4);g.setData("name",s[r]),g.setData("stop",!1),g.setData("type",s[n]),g.setBounce(0,0),g.setCollideWorldBounds(!0),g.setImmovable(!1),g.setPushable(!1),g.setBodySize(48,48),e.physics.add.collider(g,t),f.register(s[r]),v.register(s[r]),void 0!==i&&i(a)}))}))}))}static selectSpawnPoint(e){return"left"===(e=e.toLowerCase())?this.spawnPointLeft:"center"===e?this.spawnPointCenter:"right"===e?this.spawnPointRight:void 0}static getPosX(e){return"left"===(e=e.toLowerCase())?36:"center"===e?228:"right"===e?420:void 0}static getSpriteKey(e){return"regular"===(e=e.toLowerCase())?"game-enemy-regular":"speedy"===e?"game-enemy-speedy":"shooter"===e?"game-enemy-shooter":"heavy"===e?"game-enemy-heavy":void 0}}t(P,"spawnPointLeft"),t(P,"spawnPointCenter"),t(P,"spawnPointRight");class S{constructor(e,s,i){t(this,"name"),t(this,"key"),t(this,"currentDirection"),this.name=e,this.key=s,this.currentDirection=i}}class E{static register(e,t,s){void 0===this.stateControlBullets&&(this.stateControlBullets=new Array(0));const i=new S(e,t,s);this.stateControlBullets.push(i)}static unregister(e,t){}static getDirection(e){const t=this.getStateControlBullet(e);return void 0===t?-1:t.currentDirection}static isDirectionDown(e){const t=this.getStateControlBullet(e);return void 0!==t&&t.currentDirection===a.DOWN}static isDirectionLeft(e){const t=this.getStateControlBullet(e);return void 0!==t&&t.currentDirection===a.LEFT}static isDirectionRight(e){const t=this.getStateControlBullet(e);return void 0!==t&&t.currentDirection===a.RIGHT}static isDirectionUp(e){const t=this.getStateControlBullet(e);return void 0!==t&&t.currentDirection===a.UP}static getStateControlBullet(e){const t=e.getData("name"),s=e.getData("key");return this.stateControlBullets.filter((e=>e.name===t&&e.key===s))[0]}}t(E,"stateControlBullets");class w{static processMovement(e,t){e.setVelocity(0,0),t.up.isDown?this.processMovementKey(e,a.UP):t.right.isDown?this.processMovementKey(e,a.RIGHT):t.down.isDown?this.processMovementKey(e,a.DOWN):t.left.isDown&&this.processMovementKey(e,a.LEFT)}static processMovementKey(e,t){if(e.setVelocity(0,0),t===a.UP?(this.setNewDirection(a.UP),e.anims.play("game-anim-player01-up",!0),e.setVelocity(0,-this.PLAYER_SPEED)):t===a.RIGHT?(this.setNewDirection(a.RIGHT),e.anims.play("game-anim-player01-right",!0),e.setVelocity(this.PLAYER_SPEED,0)):t===a.DOWN?(this.setNewDirection(a.DOWN),e.anims.play("game-anim-player01-down",!0),e.setVelocity(0,this.PLAYER_SPEED)):t===a.LEFT&&(this.setNewDirection(a.LEFT),e.anims.play("game-anim-player01-left",!0),e.setVelocity(-this.PLAYER_SPEED,0)),this.currentDirection!==this.previousDirection){const t=a.Math.Snap.To(e.x,12),s=a.Math.Snap.To(e.y,12);e.setPosition(t,s)}}static resetDirection(){this.currentDirection=a.UP}static getDirection(){return this.currentDirection}static isDirectionDown(){return this.currentDirection===a.DOWN}static isDirectionLeft(){return this.currentDirection===a.LEFT}static isDirectionRight(){return this.currentDirection===a.RIGHT}static isDirectionUp(){return this.currentDirection===a.UP}static setNewDirection(e){this.previousDirection=this.currentDirection,this.currentDirection=e}}t(w,"PLAYER_SPEED",120),t(w,"currentDirection"),t(w,"previousDirection");class D extends a.Scene{constructor(){super({key:"StageScene"}),t(this,"cursors"),t(this,"leftTouchId"),t(this,"rightTouchId"),t(this,"leftStartPos"),t(this,"leftCurrentPos"),t(this,"background"),t(this,"logoEnemiesCount"),t(this,"logoGameOver"),t(this,"frameLayer"),t(this,"waterLayer"),t(this,"rockLayer"),t(this,"gameLayer"),t(this,"bulletsEnemies"),t(this,"bulletsPlayer1"),t(this,"enemies"),t(this,"fortress"),t(this,"player1"),t(this,"isShootingPlayer1"),t(this,"directionPlayer1"),t(this,"gameProgress"),t(this,"filesBaseKey"),t(this,"filesBaseUrl"),t(this,"gameOver"),t(this,"stageCompleted"),t(this,"sceneEnding"),t(this,"joyStick")}init(e){this.gameProgress=e,this.gameProgress.resetStageStats(),w.resetDirection(),this.filesBaseKey="game-stage"+this.gameProgress.getStageName(),this.filesBaseUrl="assets/stages/stage"+this.gameProgress.getStageName(),this.gameOver=!1,this.stageCompleted=!1,this.sceneEnding=!1,this.isShootingPlayer1=!1}preload(){this.load.image("game-background","assets/images/backgrounds/game-background.png"),this.load.tilemapTiledJSON(this.filesBaseKey+"-tilemap",this.filesBaseUrl+"-tilemap.json"),this.load.json(this.filesBaseKey+"-script",this.filesBaseUrl+"-script.json"),this.load.image("game-tileset","assets/images/tiles/game-tileset.png"),this.load.image("shooting","assets/images/sprites/shooting.png"),this.load.image("btnRight","assets/images/sprites/right.png"),this.load.spritesheet("game-bullet","assets/images/sprites/bullet.png",{frameWidth:12,frameHeight:12}),this.load.spritesheet("game-bullet-explosion","assets/images/sprites/bullet-explosion.png",{frameWidth:48,frameHeight:48}),this.load.spritesheet("game-enemy-regular","assets/images/sprites/enemy-regular.png",{frameWidth:48,frameHeight:48}),this.load.spritesheet("game-enemy-speedy","assets/images/sprites/enemy-speedy.png",{frameWidth:48,frameHeight:48}),this.load.spritesheet("game-enemy-shooter","assets/images/sprites/enemy-shooter.png",{frameWidth:48,frameHeight:48}),this.load.spritesheet("game-enemy-heavy","assets/images/sprites/enemy-heavy.png",{frameWidth:48,frameHeight:48}),this.load.spritesheet("game-fortress","assets/images/sprites/fortress.png",{frameWidth:48,frameHeight:48}),this.load.spritesheet("game-player-one","assets/images/sprites/player-one.png",{frameWidth:48,frameHeight:48}),this.load.spritesheet("game-player-two","assets/images/sprites/player-two.png",{frameWidth:48,frameHeight:48}),this.load.spritesheet("game-points","assets/images/sprites/game-points.png",{frameWidth:48,frameHeight:48}),this.load.spritesheet("game-spawn-blink","assets/images/sprites/spawn-blink.png",{frameWidth:48,frameHeight:48}),this.load.spritesheet("game-tank-explosion","assets/images/sprites/tank-explosion.png",{frameWidth:96,frameHeight:96}),this.load.image("game-enemies-count","assets/images/sprites/logo-enemies.png"),this.load.image("game-game-over","assets/images/sprites/logo-game-over.png"),this.load.image("game-level-count","assets/images/sprites/logo-flag.png"),this.load.image("game-lives-count","assets/images/sprites/logo-lives.png"),this.load.image("game-spawn-point","assets/images/sprites/spawn-point.png"),this.load.audio("bullet_shot","assets/sound/bullet_shot.ogg"),this.load.audio("bullet_hit_1","assets/sound/bullet_hit_1.ogg"),this.load.audio("bullet_hit_1","assets/sound/bullet_hit_1.ogg"),this.load.audio("explosion_1","assets/sound/explosion_1.ogg"),this.load.audio("explosion_2","assets/sound/explosion_2.ogg"),this.load.audio("background","assets/sound/background.mp3")}create(){this.cursors=this.input.keyboard.createCursorKeys(),this.resetCursorKeys(),this.input.addPointer(2),this.input.on("pointerdown",(e=>{e.x<this.cameras.main.width/2?(this.leftTouchId=e.id,this.leftStartPos=new a.Math.Vector2(e.x,e.y),this.leftCurrentPos=this.leftStartPos.clone()):(this.rightTouchId=e.id,this.handleTouchShoot())})),this.input.on("pointermove",(e=>{e.id===this.leftTouchId&&this.leftStartPos&&(this.leftCurrentPos=new a.Math.Vector2(e.x,e.y))})),this.input.on("pointerup",(e=>{e.id===this.leftTouchId&&(this.leftTouchId=void 0,this.leftStartPos=void 0,this.leftCurrentPos=void 0,this.directionPlayer1=-1),e.id===this.rightTouchId&&(this.rightTouchId=void 0)})),this.background=this.add.image(640,360,"game-background"),this.background.setOrigin(.5,.5);const e=this.make.tilemap({key:this.filesBaseKey+"-tilemap"}),t=e.addTilesetImage("game-tileset","game-tileset");if(!t)throw new Error("Failed to load game-tileset");this.frameLayer=e.createLayer("frame-layer",t,0,0),this.frameLayer.setCollisionBetween(1,9999,!0,!0),this.gameLayer=e.createLayer("game-layer",t,0,0),this.gameLayer.setCollisionBetween(1,9999,!0,!0),this.rockLayer=e.createLayer("rock-layer",t,0,0),this.rockLayer.setCollisionBetween(1,9999,!0,!0),this.waterLayer=e.createLayer("water-layer",t,0,0),this.waterLayer.setCollisionBetween(1,9999,!0,!0),e.createLayer("above-layer",t,0,0).setDepth(2),this.bulletsEnemies=this.physics.add.group(),this.bulletsPlayer1=this.physics.add.group(),this.enemies=this.physics.add.group(),this.fortress=this.physics.add.sprite(228,708,"game-fortress"),this.fortress.refreshBody(),this.fortress.setBounce(0,0),this.fortress.setCollideWorldBounds(!0),this.fortress.setImmovable(!0),this.player1=this.physics.add.sprite(132,852,"game-player-one"),this.player1.setData("name","player-one"),this.player1.setBounce(0,0),this.player1.setCollideWorldBounds(!0),this.player1.setImmovable(!1),this.player1.setPushable(!1),this.player1.setBodySize(40,40),this.logoGameOver=this.add.image(228,1e3,"game-game-over").setDepth(3),this.logoEnemiesCount=this.add.group();for(let i=0;i<10;i++)for(let e=0;e<2;e++)this.logoEnemiesCount.create(708+24*e,84+24*i,"game-enemies-count");this.setupAnimations(),this.setupCollitions();const s=this.cache.json.get(this.filesBaseKey+"-script");P.parse(this,this.enemies,s,this.enemyCreated,this.logoEnemiesCount)}handleTouchShoot(){this.createBulletForPlayerOne()}update(e){if(void 0!==this.player1.body){if(this.leftStartPos&&this.leftCurrentPos){const e=this.leftCurrentPos.x-this.leftStartPos.x,t=this.leftCurrentPos.y-this.leftStartPos.y,s=10;if(Math.abs(e)>s||Math.abs(t)>s){const s=Math.atan2(t,e),i=100;this.player1.setVelocity(Math.cos(s)*i,Math.sin(s)*i),Math.abs(e)>Math.abs(t)?this.directionPlayer1=e>0?a.RIGHT:a.LEFT:this.directionPlayer1=t>0?a.DOWN:a.UP}else this.player1.setVelocity(0,0)}this.directionPlayer1>0?w.processMovementKey(this.player1,this.directionPlayer1):w.processMovement(this.player1,this.cursors),this.cursors.space.isDown&&(this.cursors.space.reset(),this.createBulletForPlayerOne()),this.enemies.getChildren().forEach((e=>{const t=e;t.setData("shooting",!1);const s=e.getData("name").toString(),i=f.getMovement(s),a=f.getShooting(s);v.processMovement(t,i),a&&this.createBulletForEnemy(t)})),this.gameOver&&!this.sceneEnding&&this.stageFailed(),this.stageCompleted&&!this.sceneEnding&&this.stageSucceeded(),this.cursors.shift.isDown&&this.gameProgress.stageNumber<this.gameProgress.MAX_STAGE&&(this.cursors.shift.reset(),this.stageSucceeded()),this.cursors.shift.isDown&&this.gameProgress.stageNumber===this.gameProgress.MAX_STAGE&&(this.cursors.shift.reset(),this.stageFailed())}}setupAnimations(){o.create(this),h.create(this),l.create(this),m.create(this),g.create(this),c.create(this),d.create(this),u.create(this),y.create(this)}setupCollitions(){this.physics.add.collider(this.player1,this.frameLayer),this.physics.add.collider(this.player1,this.gameLayer),this.physics.add.collider(this.player1,this.fortress),this.physics.add.collider(this.player1,this.enemies),this.physics.add.collider(this.player1,this.rockLayer),this.physics.add.collider(this.player1,this.waterLayer),this.physics.add.collider(this.enemies,this.frameLayer),this.physics.add.collider(this.enemies,this.gameLayer),this.physics.add.collider(this.enemies,this.fortress),this.physics.add.collider(this.enemies,this.rockLayer),this.physics.add.collider(this.enemies,this.waterLayer),this.physics.add.collider(this.bulletsPlayer1,this.rockLayer,this.collitionDestroyBullet,null,this),this.physics.add.collider(this.bulletsPlayer1,this.frameLayer,this.collitionDestroyBullet,null,this),this.physics.add.collider(this.bulletsPlayer1,this.gameLayer,this.collitionDestroyGameLayer,null,this),this.physics.add.collider(this.bulletsPlayer1,this.fortress,this.collitionDestroyFortress,null,this),this.physics.add.collider(this.bulletsPlayer1,this.enemies,this.collitionDestroyEnemy,null,this),this.physics.add.collider(this.bulletsPlayer1,this.bulletsEnemies,this.collitionDestroyBullets,null,this),this.physics.add.collider(this.bulletsEnemies,this.player1,this.collitionDestroyPlayer,null,this),this.physics.add.collider(this.bulletsEnemies,this.rockLayer,this.collitionDestroyBullet,null,this),this.physics.add.collider(this.bulletsEnemies,this.frameLayer,this.collitionDestroyBullet,null,this),this.physics.add.collider(this.bulletsEnemies,this.gameLayer,this.collitionDestroyGameLayer,null,this),this.physics.add.collider(this.bulletsEnemies,this.fortress,this.collitionDestroyFortress,null,this)}createBulletForPlayerOne(){if(this.sound.play("bullet_shot"),this.isShootingPlayer1)return;this.isShootingPlayer1=!0;let e="",t=0,s=0,i=0,r=0;const n=w.getDirection();n==a.UP||null==n?(e="game-anim-bullet-up",t=this.player1.x,s=this.player1.y-12,i=0,r=-320):n==a.RIGHT?(e="game-anim-bullet-right",t=this.player1.x+12,s=this.player1.y,i=320,r=0):n==a.DOWN?(e="game-anim-bullet-down",t=this.player1.x,s=this.player1.y+12,i=0,r=320):n==a.LEFT&&(e="game-anim-bullet-left",t=this.player1.x-12,s=this.player1.y,i=-320,r=0);const o=this.bulletsPlayer1.create(t,s,"game-bullet");o.setData("name","player-one-bullet"),o.setData("key",a.Math.RND.integer()),o.setBounce(0,0),o.setCollideWorldBounds(!0),o.setVelocity(i,r),o.anims.play(e,!0),this.time.delayedCall(300,(()=>{this.isShootingPlayer1=!1}));const h=w.getDirection();E.register(o.getData("name"),o.getData("key"),h)}createBulletForEnemy(e){if(e.getData("shooting"))return;e.setData("shooting",!0),this.time.delayedCall(1e3,(()=>{e.setData("shooting",!1)}));let t="",s=0,i=0,r=0,n=0;const o=v.getDirection(e);o==a.UP?(t="game-anim-bullet-up",s=e.x,i=e.y-12,r=0,n=-320):o==a.RIGHT?(t="game-anim-bullet-right",s=e.x+12,i=e.y,r=320,n=0):o==a.DOWN?(t="game-anim-bullet-down",s=e.x,i=e.y+12,r=0,n=320):o==a.LEFT&&(t="game-anim-bullet-left",s=e.x-12,i=e.y,r=-320,n=0);const h=this.bulletsEnemies.create(s,i,"game-bullet");h.setBounce(0,0),h.setCollideWorldBounds(!0),h.setData("name","enemy-bullet"),h.setData("key",a.Math.RND.integer()),h.setVelocity(r,n),h.anims.play(t,!0);const l=v.getDirection(e);E.register(h.getData("name"),h.getData("key"),l)}collitionDestroyBullet(e,t){void 0!==e.getData&&(this.sound.play("explosion_1"),e.anims.play("game-anim-bullet-explosion",!0),"player-one-bullet"===e.getData("name")&&this.time.delayedCall(150,(()=>{this.bulletsPlayer1.remove(e,!0,!0)})),"enemy-bullet"===e.getData("name")&&this.time.delayedCall(150,(()=>{this.bulletsEnemies.remove(e,!0,!0)}))),void 0!==t.getData&&(this.sound.play("explosion_1"),t.anims.play("game-anim-bullet-explosion",!0),void 0!==t.getData&&"player-one-bullet"===t.getData("name")&&this.time.delayedCall(150,(()=>{this.bulletsPlayer1.remove(t,!0,!0)})),void 0!==t.getData&&"enemy-bullet"===t.getData("name")&&this.time.delayedCall(150,(()=>{this.bulletsEnemies.remove(t,!0,!0)})))}collitionDestroyBullets(e,t){this.bulletsPlayer1.remove(e,!0,!0),this.bulletsEnemies.remove(t,!0,!0)}collitionDestroyEnemy(e,t){this.sound.play("explosion_2"),e.anims.play("game-anim-bullet-explosion",!0),this.time.delayedCall(150,(()=>{this.bulletsPlayer1.remove(e,!0,!0)}));const s=t.getData("type"),i="game-anim-"+s+"-explosion";"regular"===s?this.gameProgress.playerOneRegularsCount+=1:"speedy"===s?this.gameProgress.playerOneSpeediesCount+=1:"shooter"===s?this.gameProgress.playerOneShootersCount+=1:"heavy"===s&&(this.gameProgress.playerOneHeaviesCount+=1),t.body.enable=!1,t.setData("stop",!0),t.anims.play(i,!0),this.time.delayedCall(1e3,(()=>{this.enemies.remove(t,!0,!0),this.checkStageCompleted()}))}collitionDestroyFortress(e,t){this.fortress.anims.play("game-anim-fortress-destroyed"),this.bulletsPlayer1.remove(t,!0,!0),this.bulletsEnemies.remove(t,!0,!0),this.gameOver=!0}collitionDestroyGameLayer(e,t){e.anims.play("game-anim-bullet-explosion",!0);const s=e.getData("name");"player-one-bullet"===s?this.time.delayedCall(150,(()=>{this.bulletsPlayer1.remove(e,!0,!0)})):"enemy-bullet"===s&&this.time.delayedCall(150,(()=>{this.bulletsEnemies.remove(e,!0,!0)}));const i=E.getDirection(e),r=this.gameLayer.worldToTileXY(e.x,e.y);i==a.UP?(this.gameLayer.removeTileAt(r.x+1,r.y-1),this.gameLayer.removeTileAt(r.x+0,r.y-1),this.gameLayer.removeTileAt(r.x-1,r.y-1),this.gameLayer.removeTileAt(r.x-2,r.y-1)):i==a.RIGHT?(this.gameLayer.removeTileAt(r.x+1,r.y-2),this.gameLayer.removeTileAt(r.x+1,r.y-1),this.gameLayer.removeTileAt(r.x+1,r.y+0),this.gameLayer.removeTileAt(r.x+1,r.y+1)):i==a.DOWN?(this.gameLayer.removeTileAt(r.x+1,r.y+1),this.gameLayer.removeTileAt(r.x+0,r.y+1),this.gameLayer.removeTileAt(r.x-1,r.y+1),this.gameLayer.removeTileAt(r.x-2,r.y+1)):i==a.LEFT&&(this.gameLayer.removeTileAt(r.x-1,r.y-2),this.gameLayer.removeTileAt(r.x-1,r.y-1),this.gameLayer.removeTileAt(r.x-1,r.y+0),this.gameLayer.removeTileAt(r.x-1,r.y+1))}collitionDestroyPlayer(e,t){t.anims.play("game-anim-bullet-explosion",!0),t.body.enable=!1,this.bulletsEnemies.remove(t,!0,!0),this.gameProgress.playerOneLives-=1,this.gameProgress.playerOneLives>=0?this.player1.setPosition(264,648):(this.gameOver=!0,this.player1.setVisible(!1))}enemyCreated(e){e.remove(e.getLast(!0),!0,!0)}resetCursorKeys(){this.cursors.down.reset(),this.cursors.left.reset(),this.cursors.right.reset(),this.cursors.shift.reset(),this.cursors.space.reset(),this.cursors.up.reset()}checkStageCompleted(){0===this.logoEnemiesCount.getLength()&&0===this.enemies.getLength()&&(this.stageCompleted=!0)}stageFailed(){this.sceneEnding||(this.sceneEnding=!0,this.tweens.add({duration:2e3,ease:"Back",repeat:0,targets:this.logoGameOver,y:"500",yoyo:!1}),this.time.delayedCall(3e3,(()=>{this.scene.start("GameOverScene")})))}stageSucceeded(){this.sceneEnding||(this.sceneEnding=!0,this.time.delayedCall(2e3,(()=>{this.resetCursorKeys(),this.scene.start("ScoresScene",this.gameProgress)})))}}class T extends a.Scene{constructor(){super({key:"StageNumberScene"}),t(this,"background"),t(this,"textStageNumber"),t(this,"gameProgress")}init(e){this.gameProgress=e}preload(){this.load.image("load-background","assets/images/backgrounds/load-background.png")}create(){this.background=this.add.image(228,444,"load-background").setOrigin(.5,.5),this.textStageNumber=this.add.bitmapText(228,340,"console-font","STAGE  "+this.gameProgress.stageNumber,24).setOrigin(.5,.5),this.textStageNumber.setTint(1118481),this.cameras.main.setScroll(0,-720),this.cameras.main.pan(228,444,500,"Linear",!1),this.time.delayedCall(2e3,(()=>{this.scene.start("StageScene",this.gameProgress)}))}update(e){}}class O{static buildStageName(e){return e<10?"0"+e.toString():e.toString()}}class C{constructor(){t(this,"POINTS_REGULAR_ENEMY",100),t(this,"POINTS_SPEEDY_ENEMY",200),t(this,"POINTS_SHOOTER_ENEMY",300),t(this,"POINTS_HEAVY_ENEMY",400),t(this,"MAX_STAGE",4),t(this,"stageNumber"),t(this,"playerOneLives"),t(this,"playerOneTotalPoints"),t(this,"playerOneStageCount"),t(this,"playerOneStagePoints"),t(this,"playerOneRegularsCount"),t(this,"playerOneRegularsPoints"),t(this,"playerOneSpeediesCount"),t(this,"playerOneSpeediesPoints"),t(this,"playerOneShootersCount"),t(this,"playerOneShootersPoints"),t(this,"playerOneHeaviesCount"),t(this,"playerOneHeaviesPoints"),t(this,"playerTwoLives"),t(this,"playerTwoTotalPoints"),t(this,"playerTwoStageCount"),t(this,"playerTwoStagePoints"),t(this,"playerTwoRegularsCount"),t(this,"playerTwoRegularsPoints"),t(this,"playerTwoSpeediesCount"),t(this,"playerTwoSpeediesPoints"),t(this,"playerTwoShootersCount"),t(this,"playerTwoShootersPoints"),t(this,"playerTwoHeaviesCount"),t(this,"playerTwoHeaviesPoints")}resetGameProgress(){this.resetPlayerOne(),this.resetPlayerTwo(),this.resetStageProgress(),this.resetStageStats()}resetPlayerOne(){this.playerOneLives=2,this.playerOneTotalPoints=0}resetPlayerTwo(){this.playerTwoLives=2,this.playerOneTotalPoints=0}resetStageProgress(){this.stageNumber=0}resetStageStats(){this.playerOneRegularsCount=0,this.playerOneRegularsPoints=0,this.playerOneSpeediesCount=0,this.playerOneSpeediesPoints=0,this.playerOneShootersCount=0,this.playerOneShootersPoints=0,this.playerOneHeaviesCount=0,this.playerOneHeaviesPoints=0,this.playerOneStageCount=0,this.playerOneStagePoints=0,this.playerTwoRegularsCount=0,this.playerTwoRegularsPoints=0,this.playerTwoSpeediesCount=0,this.playerTwoSpeediesPoints=0,this.playerTwoShootersCount=0,this.playerTwoShootersPoints=0,this.playerTwoHeaviesCount=0,this.playerTwoHeaviesPoints=0,this.playerTwoStageCount=0,this.playerTwoStagePoints=0}getStageName(){return O.buildStageName(this.stageNumber)}nextStage(){this.stageNumber+=1}calculateStageStats(){this.playerOneRegularsPoints=this.playerOneRegularsCount*this.POINTS_REGULAR_ENEMY,this.playerOneSpeediesPoints=this.playerOneSpeediesCount*this.POINTS_SPEEDY_ENEMY,this.playerOneShootersPoints=this.playerOneShootersCount*this.POINTS_SHOOTER_ENEMY,this.playerOneHeaviesPoints=this.playerOneHeaviesCount*this.POINTS_HEAVY_ENEMY,this.playerOneStageCount=this.playerOneRegularsCount+this.playerOneSpeediesCount+this.playerOneShootersCount+this.playerOneHeaviesCount,this.playerOneStagePoints=this.playerOneRegularsPoints+this.playerOneSpeediesPoints+this.playerOneShootersPoints+this.playerOneHeaviesPoints,this.playerOneTotalPoints+=this.playerOneStagePoints,this.playerTwoRegularsPoints=this.playerTwoRegularsCount*this.POINTS_REGULAR_ENEMY,this.playerTwoSpeediesPoints=this.playerTwoSpeediesCount*this.POINTS_SPEEDY_ENEMY,this.playerTwoShootersPoints=this.playerTwoShootersCount*this.POINTS_SHOOTER_ENEMY,this.playerTwoHeaviesPoints=this.playerTwoHeaviesCount*this.POINTS_HEAVY_ENEMY,this.playerTwoStageCount=this.playerTwoRegularsCount+this.playerTwoSpeediesCount+this.playerTwoShootersCount+this.playerTwoHeaviesCount,this.playerTwoStagePoints=this.playerTwoRegularsPoints+this.playerTwoSpeediesPoints+this.playerTwoShootersPoints+this.playerTwoHeaviesPoints,this.playerTwoTotalPoints+=this.playerTwoStagePoints}}class x extends a.Scene{constructor(){super({key:"WelcomeScene"}),t(this,"background"),t(this,"textStart"),t(this,"cursors"),t(this,"blink"),t(this,"gameProgress"),this.gameProgress=new C}init(e){this.blink=!1,this.gameProgress.resetGameProgress()}preload(){this.load.audio("welcome-music","assets/sound/stage_start.ogg"),this.load.image("welcome-background","assets/images/backgrounds/welcome-background.png"),this.load.bitmapFont("console-font","assets/fonts/press-start-2p.png","assets/fonts/press-start-2p.fnt")}create(){this.sound.play("welcome-music",{loop:!1,volume:.5}),this.background=this.add.image(228,100,"welcome-background").setOrigin(.5,0),this.cursors=this.input.keyboard.createCursorKeys(),this.textStart=this.add.bitmapText(228,432,"console-font","RULE THE SEA",24).setOrigin(.5,.5),this.textStart.setTint(15658734),this.cameras.main.setScroll(0,-720),this.cameras.main.pan(228,360,2e3,"Linear",!1),this.time.addEvent({callback:this.blinkBackground,callbackScope:this,delay:500,loop:!0}),this.input.once("pointerdown",(()=>{this.nextScene()}))}nextScene(){this.cursors.space.reset(),this.gameProgress.nextStage(),this.scene.start("StageNumberScene",this.gameProgress)}update(e){this.cursors.space.isDown&&this.nextScene()}blinkBackground(){this.textStart.setVisible(this.blink),this.blink=!this.blink}}const k=Phaser.Input.Keyboard.Key,N=Phaser.Input.Keyboard.KeyCodes,_=["up","down","left","right"];class R{constructor(e){this.scene=e,this.keys={},this.cursorKeys={},this.noKeyDown=!0;for(var t=0,s=_.length;t<s;t++){var i=_[t];this.addKey(i),this.cursorKeys[i]=this.keys[i]}}shutdown(e){for(var t in this.scene=void 0,this.keys)this.keys[t].destroy();this.keys=void 0,this.cursorKeys=void 0}destroy(e){shutdown(e)}createCursorKeys(){return this.cursorKeys}setKeyState(e,t){var s=this.keys[e];return s.enabled?(t&&(this.noKeyDown=!1),s.isDown!==t&&(L.timeStamp=Date.now(),L.keyCode=s.keyCode,t?s.onDown(L):s.onUp(L)),this):this}clearAllKeysState(){for(var e in this.noKeyDown=!0,this.keys)this.setKeyState(e,!1);return this}getKeyState(e){return this.keys[e]}get upKeyDown(){return this.keys.up.isDown}get downKeyDown(){return this.keys.down.isDown}get leftKeyDown(){return this.keys.left.isDown}get rightKeyDown(){return this.keys.right.isDown}get anyKeyDown(){return!this.noKeyDown}addKey(e,t){return void 0===t&&(t=e),"string"==typeof t&&(t=t.toUpperCase(),N.hasOwnProperty(t)&&(t=N[t])),this.keys[e]=new k(this.scene,t),this}addKeys(e){for(var t=0,s=e.length;t<s;t++)this.addKey(e[t]);return this}}var L={timeStamp:0,keyCode:0,altKey:!1,ctrlKey:!1,shiftKey:!1,metaKey:!1,location:0},M=180/Math.PI;const F={"up&down":0,"left&right":1,"4dir":2,"8dir":3};var H={};const K=Phaser.Utils.Objects.GetValue,B=Phaser.Math.Distance.Between,A=Phaser.Math.Angle.Between;class I extends R{constructor(e,t){super(e),this.resetFromJSON(t)}resetFromJSON(e){null==this.start&&(this.start={x:0,y:0}),null==this.end&&(this.end={x:0,y:0}),this._enable=void 0,this.setEnable(K(e,"enable",!0)),this.setMode(K(e,"dir","8dir")),this.setDistanceThreshold(K(e,"forceMin",16));var t=K(e,"start.x",null),s=K(e,"start.y",null),i=K(e,"end.x",null),a=K(e,"end.y",null);return this.setVector(t,s,i,a),this}toJSON(){return{enable:this.enable,dir:this.dirMode,forceMin:this.forceMin,start:{x:this.start.x,y:this.start.y},end:{x:this.end.x,y:this.end.y}}}setMode(e){return"string"==typeof e&&(e=F[e]),this.dirMode=e,this}get enable(){return this._enable}set enable(e){if(this._enable!==e)return e||this.clearVector(),this._enable=e,this}setEnable(e){return void 0===e&&(e=!0),this.enable=e,this}toggleEnable(){return this.setEnable(!this.enable),this}setDistanceThreshold(e){return e<0&&(e=0),this.forceMin=e,this}clearVector(){return this.start.x=0,this.start.y=0,this.end.x=0,this.end.y=0,this.clearAllKeysState(),this}setVector(e,t,s,i){if(!this.enable)return this;if(null===e)return this.clearVector(),this;if(void 0===s&&(s=e,e=0,i=t,t=0),this.start.x=e,this.start.y=t,this.end.x=s,this.end.y=i,this.forceMin>0&&this.force<this.forceMin)this.clearAllKeysState();else{this.noKeyDown=!0;var a=function(e,t,s){switch(void 0===s?s={}:!0===s&&(s=H),s.left=!1,s.right=!1,s.up=!1,s.down=!1,e=(e+360)%360,t){case 0:e<180?s.down=!0:s.up=!0;break;case 1:e>90&&e<=270?s.left=!0:s.right=!0;break;case 2:e>45&&e<=135?s.down=!0:e>135&&e<=225?s.left=!0:e>225&&e<=315?s.up=!0:s.right=!0;break;case 3:e>22.5&&e<=67.5?(s.down=!0,s.right=!0):e>67.5&&e<=112.5?s.down=!0:e>112.5&&e<=157.5?(s.down=!0,s.left=!0):e>157.5&&e<=202.5?s.left=!0:e>202.5&&e<=247.5?(s.left=!0,s.up=!0):e>247.5&&e<=292.5?s.up=!0:e>292.5&&e<=337.5?(s.up=!0,s.right=!0):s.right=!0}return s}(this.angle,this.dirMode,!0);for(var r in a)this.setKeyState(r,a[r])}return this}get forceX(){return this.end.x-this.start.x}get forceY(){return this.end.y-this.start.y}get force(){return B(this.start.x,this.start.y,this.end.x,this.end.y)}get rotation(){return A(this.start.x,this.start.y,this.end.x,this.end.y)}get angle(){return this.rotation*M}get octant(){var e=0;return this.rightKeyDown?e=this.downKeyDown?45:0:this.downKeyDown?e=this.leftKeyDown?135:90:this.leftKeyDown?e=this.upKeyDown?225:180:this.upKeyDown&&(e=this.rightKeyDown?315:270),e}}const V={setEventEmitter(e,t){return void 0===t&&(t=Phaser.Events.EventEmitter),this._privateEE=!0===e||void 0===e,this._eventEmitter=this._privateEE?new t:e,this},destroyEventEmitter(){return this._eventEmitter&&this._privateEE&&this._eventEmitter.shutdown(),this},getEventEmitter(){return this._eventEmitter},on(){return this._eventEmitter&&this._eventEmitter.on.apply(this._eventEmitter,arguments),this},once(){return this._eventEmitter&&this._eventEmitter.once.apply(this._eventEmitter,arguments),this},off(){return this._eventEmitter&&this._eventEmitter.off.apply(this._eventEmitter,arguments),this},emit(e){return this._eventEmitter&&e&&this._eventEmitter.emit.apply(this._eventEmitter,arguments),this},addListener(){return this._eventEmitter&&this._eventEmitter.addListener.apply(this._eventEmitter,arguments),this},removeListener(){return this._eventEmitter&&this._eventEmitter.removeListener.apply(this._eventEmitter,arguments),this},removeAllListeners(){return this._eventEmitter&&this._eventEmitter.removeAllListeners.apply(this._eventEmitter,arguments),this},listenerCount(){return this._eventEmitter?this._eventEmitter.listenerCount.apply(this._eventEmitter,arguments):0},listeners(){return this._eventEmitter?this._eventEmitter.listeners.apply(this._eventEmitter,arguments):[]},eventNames(){return this._eventEmitter?this._eventEmitter.eventNames.apply(this._eventEmitter,arguments):[]}};var U={};const G=Phaser.Utils.Objects.GetValue,Y=Phaser.Geom.Circle,W=Phaser.Geom.Circle.Contains;class X extends I{constructor(e,t){var s=e.scene;super(s,t);var i=G(t,"eventEmitter",void 0),a=G(t,"EventEmitterClass",void 0);this.setEventEmitter(i,a),this.scene=s,this.mainCamera=s.sys.cameras.main,this.pointer=void 0,this.gameObject=e,this.radius=G(t,"radius",100),e.setInteractive(new Y(e.displayOriginX,e.displayOriginY,this.radius),W),this.boot()}resetFromJSON(e){return super.resetFromJSON(e),this.pointer=void 0,this}toJSON(){var e=super.toJSON();return e.radius=this.radius,e}boot(){this.gameObject.on("pointerdown",this.onKeyDownStart,this),this.gameObject.on("pointerover",this.onKeyDownStart,this),this.scene.input.on("pointermove",this.onKeyDown,this),this.scene.input.on("pointerup",this.onKeyUp,this),this.gameObject.once("destroy",this.onParentDestroy,this)}shutdown(e){this.scene&&(this.scene.input.off("pointermove",this.onKeyDown,this),this.scene.input.off("pointerup",this.onKeyUp,this),this.destroyEventEmitter(),this.scene=void 0,this.mainCamera=void 0,this.pointer=void 0,this.gameObject=void 0,super.shutdown())}get enable(){return this._enable}set enable(e){if(this._enable!==e)return e||(this.pointer=void 0),super.enable=e,this}destroy(e){this.shutdown(e)}onParentDestroy(e,t){this.destroy(t)}onKeyDownStart(e){e.isDown&&void 0===this.pointer&&(this.pointer=e,this.onKeyDown(e),this.emit("pointerdown",e))}onKeyDown(e){if(this.pointer===e){var t=function(e,t,s){var i=e.camera;return i?(void 0===s?s={}:!0===s&&(s=U),i===t?(s.x=e.worldX,s.y=e.worldY):i.getWorldPoint(e.x,e.y,s),s):null}(e,this.mainCamera,!0);if(t){var s=e.camera,i=this.gameObject,a=i.x-s.scrollX*(i.scrollFactorX-1),r=i.y-s.scrollY*(i.scrollFactorY-1);this.setVector(a,r,t.x,t.y),this.emit("update")}}}onKeyUp(e){this.pointer===e&&(this.pointer=void 0,this.clearVector(),this.emit("update"),this.emit("pointerup",e))}forceUpdate(){var e=this.pointer;return e&&e.isDown?(this.onKeyDown(e),this):this}}Object.assign(X.prototype,V);const j=Phaser.Utils.Objects.GetValue;class J{constructor(e,t){void 0===t&&(t={});var s=j(t,"eventEmitter",void 0),i=j(t,"EventEmitterClass",void 0);this.setEventEmitter(s,i),t.eventEmitter=this.getEventEmitter(),this.scene=e,this.base=void 0,this.thumb=void 0,this.touchCursor=void 0,this.setRadius(j(t,"radius",100)),this.addBase(j(t,"base",void 0),t),this.addThumb(j(t,"thumb",void 0));var a=j(t,"x",0),r=j(t,"y",0);this.base.setPosition(a,r),this.thumb.setPosition(a,r),j(t,"fixed",!0)&&this.setScrollFactor(0),this.boot()}destroy(){this.destroyEventEmitter(),this.base.destroy(),this.thumb.destroy(),this.scene=void 0,this.base=void 0,this.thumb=void 0,this.touchCursor=void 0}createCursorKeys(){return this.touchCursor.createCursorKeys()}get forceX(){return this.touchCursor.forceX}get forceY(){return this.touchCursor.forceY}get force(){return this.touchCursor.force}get rotation(){return this.touchCursor.rotation}get angle(){return this.touchCursor.angle}get up(){return this.touchCursor.upKeyDown}get down(){return this.touchCursor.downKeyDown}get left(){return this.touchCursor.leftKeyDown}get right(){return this.touchCursor.rightKeyDown}get noKey(){return this.touchCursor.noKeyDown}get pointerX(){return this.touchCursor.end.x}get pointerY(){return this.touchCursor.end.y}get pointer(){return this.touchCursor.pointer}setPosition(e,t){return this.x===e&&this.y===t||(this.x=e,this.y=t,this.forceUpdateThumb()),this}set x(e){this.x!==e&&(this.base.x=e,this.thumb.x=e)}set y(e){this.y!==e&&(this.base.y=e,this.thumb.y=e)}get x(){return this.base.x}get y(){return this.base.y}setVisible(e){return this.visible=e,this}toggleVisible(){return this.visible=!this.visible,this}get visible(){return this.base.visible}set visible(e){this.base.visible=e,this.thumb.visible=e,this.enable=e}get enable(){return this.touchCursor.enable}set enable(e){this.touchCursor.setEnable(e)}setEnable(e){return void 0===e&&(e=!0),this.enable=e,this}toggleEnable(){return this.setEnable(!this.enable),this}setRadius(e){return this.radius=e,this}addBase(e,t){return this.base&&this.base.destroy(),void 0===e&&(e=this.scene.add.circle(0,0,this.radius).setStrokeStyle(3,255)),void 0===t&&(t={}),t.eventEmitter=this.getEventEmitter(),this.touchCursor=new X(e,t),this.base=e,this}addThumb(e){return this.thumb&&this.thumb.destroy(),void 0===e&&(e=this.scene.add.circle(0,0,40).setStrokeStyle(3,65280)),this.thumb=e,this}setScrollFactor(e){return this.base.setScrollFactor(e),this.thumb.setScrollFactor(e),this}boot(){this.on("update",this.update,this)}update(){var e,t,s=this.touchCursor,i=s.dirMode;if(s.anyKeyDown)if(s.force>this.radius){var a=s.rotation;e=0!==i?Math.cos(a)*this.radius:0,t=1!==i?Math.sin(a)*this.radius:0}else e=0!==i?s.forceX:0,t=1!==i?s.forceY:0;else e=0,t=0;return this.thumb.x=this.base.x+e,this.thumb.y=this.base.y+t,this}forceUpdateThumb(){return this.touchCursor.forceUpdate(),this}}Object.assign(J.prototype,V);class z extends Phaser.Plugins.BasePlugin{constructor(e){super(e)}start(){this.game.events.on("destroy",this.destroy,this)}add(e,t){return new J(e,t)}addVectorToCursorKeys(e){return new I(void 0,e)}}const q={backgroundColor:"000000",parent:"game",physics:{arcade:{debug:!1,gravity:{x:0,y:0}},default:"arcade"},plugins:{global:[{key:"rexVirtualJoystick",plugin:z,start:!0}]},scale:{mode:a.Scale.FIT,autoCenter:a.Scale.CENTER_BOTH},render:{pixelArt:!0,antialias:!1},scene:[x,r,n,D,T],title:"Mini Battle City",type:a.AUTO,width:456,height:888};document.addEventListener("DOMContentLoaded",(()=>{new a.Game({...q,parent:"game-container"})}));
